# Make a new directory for the project called FYP and then make directories for the raw fastq files and FASTQC
mkdir -p /media/newdrive/GCB2024/sallyowens/FYP/raw_fastq/FastQC

# Upload fastq files into cyberduck into raw_fastq directory. 
# Run FASTQC on files
# nohup & allows command to run in the backround
# wildcard (*) runs command on all files ending with .fq.gz
# --ourdir= put the output in the desired directory (FastQC)
nohup fastqc *.fq.gz --outdir=/media/newdrive/GCB2024/sallyowens/FYP/raw_fastq/FastQC &

# run MultiQC on FastQC reports to generate summary report for quality assessment on reads
multiqc /media/newdrive/GCB2024/sallyowens/FYP/raw_fastq/FastQC

# aligning reads to reference genome using STAR
# Genome indices had already been generated using the following code
# STAR --runThreadN 32 --runMode genomeGenerate --genomeDir /media/newdrive/data/Reference_genomes/Human/UCSC/STAR --genomeFastaFiles /media/newdrive/data/Reference_genomes/Human/UCSC/hg38.fa --sjdbGTFfile /media/newdrive/data/Reference_genomes/Human/UCSC/hg38.ncbiRefSeq.gtf --sjdbOverhang 149

# General code to align reads
# STAR --genomeDir /media/newdrive/data/Reference_genomes/Human/UCSC/STAR_UCSC_refseq/ --runThreadN 12 --readFilesIn S1_1.fq.gz S1_2.fq.gz --readFilesCommand zcat --outFileNamePrefix S1 --outSAMtype BAM SortedByCoordinate --outSAMunmapped Within --outSAMattributes Standard 

# this outputs files ending in _1.fq.gz, _2.fq.gz and the file with the same name, to check input files before running alignment 
for i in *_1.fq.gz; do
echo 
echo $i
echo ${i%_1.fq.gz}_2.fq.gz
echo ${i%_1.fq.gz}
echo 
done

# To test a loop to align all fastq files within a directory, dry run of STAR alignemnt step
for i in *_1.fq.gz; do
echo STAR --genomeDir /media/newdrive/data/Reference_genomes/Human/UCSC/STAR_UCSC_refseq/ --runThreadN 12 --readFilesIn $i ${i%_1.fq.gz}_2.fq.gz --readFilesCommand zcat --outFileNamePrefix ${i%_1.fq.gz} --outSAMtype BAM SortedByCoordinate --outSAMunmapped Within --outSAMattributes Standard
done


# To align all fastq files within a directory using STAR
# 
nohup sh -c 'for i in *_1.fq.gz; do
STAR --genomeDir /media/newdrive/data/Reference_genomes/Human/UCSC/STAR_UCSC_refseq/ --runThreadN 12 --readFilesIn $i ${i%_1.fq.gz}_2.fq.gz --readFilesCommand zcat --outFileNamePrefix ${i%_1.fq.gz} --outSAMtype BAM SortedByCoordinate --outSAMunmapped Within --outSAMattributes Standard
done' &
